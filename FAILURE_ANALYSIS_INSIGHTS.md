# 🔍 SWE-agent 失败路径深度分析报告

## 📊 执行摘要

基于 **3,591 个真实轨迹**的分析，我们深入研究了 SWE-agent 的失败模式。

### 核心发现

| 指标 | 数值 | 洞察 |
|------|------|------|
| 总轨迹数 | 3,591 | 大规模真实数据 |
| 成功率 | **9.52%** | 失败率高达 90.48% |
| 失败案例 | **3,249** | 丰富的失败样本 |
| 平均步骤（失败） | **30.4 步** | 失败前尝试了 2 倍步骤 |
| 平均步骤（成功） | **14.6 步** | 更高效、更直接 |
| 首次错误出现 | **第 6.9 步** | 早期就出现问题 |

---

## ❌ 失败原因分析

### Top 10 失败原因

| 排名 | 失败类型 | 次数 | 占比 | 说明 |
|------|---------|------|------|------|
| 1 | **runtime_error** | 22,993 | 31.9% | 运行时错误（最常见） |
| 2 | **test_failure** | 16,672 | 23.2% | 测试失败 |
| 3 | **syntax_error** | 6,317 | 8.8% | 语法错误 |
| 4 | **value_error** | 5,671 | 7.9% | 值错误 |
| 5 | **type_error** | 4,747 | 6.6% | 类型错误 |
| 6 | **connection_error** | 3,648 | 5.1% | 连接错误 |
| 7 | **import_error** | 2,956 | 4.1% | 导入错误 |
| 8 | **timeout** | 2,802 | 3.9% | 超时 |
| 9 | **attribute_error** | 2,744 | 3.8% | 属性错误 |
| 10 | **file_not_found** | 2,202 | 3.1% | 文件未找到 |

### 关键洞察

1. **运行时错误最多**（32%）
   - 说明代码能编译但运行失败
   - 可能是逻辑错误、边界条件未处理

2. **测试失败占 23%**
   - agent 修改了代码但没有通过测试
   - 说明修改方向可能正确但不完整

3. **语法错误占 9%**
   - agent 生成的代码有语法问题
   - 可能是缩进、括号、引号等基础错误

4. **连接/超时错误占 9%**
   - 可能是环境问题
   - 或者任务本身就需要很长时间

---

## ⏱️ 失败阶段分析

### 失败发生时间

| 阶段 | 步骤范围 | 失败次数 | 占比 | 解释 |
|------|---------|---------|------|------|
| **Early** (早期) | 0-10 步 | 2,390 | **73.6%** | 大多数失败在早期就出现！ |
| **Middle** (中期) | 10-30 步 | 660 | 20.3% | 较少失败 |
| **Late** (后期) | 30+ 步 | 33 | 1.0% | 很少 |
| No Error Detected | - | 166 | 5.1% | 没有明显错误但仍失败 |

### 关键洞察

**🔑 73.6% 的失败在前 10 步就出现！**

这说明：
- **早期决策至关重要**：如果前 10 步方向错误，很难恢复
- **搜索策略很重要**：需要快速找到正确的文件和代码位置
- **理解问题是关键**：对问题的理解不准确会导致早期失败

**平均首次错误步骤：6.9**
- 大约在第 7 步就遇到第一个错误
- 从那时起 agent 尝试恢复，但通常失败

---

## 📏 步骤数对比：成功 vs 失败

### 统计对比

| 指标 | 成功案例 | 失败案例 | 差异 |
|------|---------|---------|------|
| **平均步骤数** | 14.6 | 30.4 | **+108%** |
| 最小步骤 | 3 | 1 | - |
| 最大步骤 | 101 | 349 | - |

### 关键洞察

**失败案例平均需要 2 倍多的步骤！**

- **成功路径更直接**：平均 14.6 步就能解决问题
- **失败路径冗长**：平均 30.4 步，尝试了很多无效操作
- **效率差异明显**：失败案例浪费了大量步骤在错误方向上

**可能原因**:
1. 找不到正确的文件/代码
2. 反复尝试错误的修复方案
3. 陷入循环模式（见下文）
4. 理解问题不准确

---

## 🎯 动作类型分布对比

### 成功 vs 失败的动作分布

| 动作类型 | 成功案例 | 失败案例 | 差异 | 分析 |
|---------|---------|---------|------|------|
| **edit** | 30.40% | 24.45% | **+5.95%** | ✅ 成功案例更多编辑 |
| **search** | 22.54% | 28.88% | **-6.34%** | ❌ 失败案例搜索更多 |
| **read** | 29.14% | 26.70% | +2.44% | 大致相同 |
| **execute** | 5.63% | 6.38% | -0.75% | 失败案例执行更多 |
| **test** | 3.87% | 2.99% | **+0.88%** | ✅ 成功案例测试更多 |
| **navigate** | 1.56% | 3.64% | **-2.08%** | ❌ 失败案例导航更多 |
| **create** | 3.39% | 3.13% | +0.26% | 大致相同 |

### 关键洞察

#### ✅ 成功案例的特征

1. **更多编辑动作** (+5.95%)
   - 找到正确位置后直接修改
   - 更有决断力

2. **更多测试** (+0.88%)
   - 验证修改是否正确
   - 质量保证意识强

3. **更少搜索** (-6.34%)
   - 快速找到目标
   - 不浪费时间

#### ❌ 失败案例的特征

1. **过度搜索** (+6.34%)
   - 找不到正确的文件/代码
   - 迷失方向

2. **过多导航** (+2.08%)
   - 在目录结构中徘徊
   - 没有明确目标

3. **编辑不足** (-5.95%)
   - 花太多时间搜索
   - 没有实际修改代码

---

## 🔄 循环模式分析

### 循环检测结果

| 案例类型 | 循环率 | 解释 |
|---------|--------|------|
| **失败案例** | **80.0%** | 4/5 的失败案例陷入循环！ |
| **成功案例** | **66.0%** | 2/3 的成功案例也有循环 |
| **差异** | **+14.0%** | 失败案例更容易陷入循环 |

### 关键洞察

**循环 = 重复相同的动作模式**

1. **失败案例更容易陷入循环** (80% vs 66%)
   - 反复尝试相同的操作
   - 没有学习到教训
   - 缺乏策略调整

2. **即使成功案例也有 66% 循环**
   - 说明某种程度的重复是正常的
   - 可能是迭代式修复（合理的循环）

3. **循环类型示例**:
   - `search → search → search`（过度搜索）
   - `edit → edit → edit`（反复修改）
   - `read → read → read`（重复阅读）

---

## 📈 动作序列模式分析

### ✅ Top 10 成功动作序列

| 排名 | 序列 | 次数 | 模式说明 |
|------|------|------|----------|
| 1 | `edit → edit → edit` | 287 | 连续编辑（迭代修复） |
| 2 | `search → search → search` | 278 | 多次搜索（找到正确位置） |
| 3 | `read → edit → edit` | 166 | 读后连续编辑 |
| 4 | `search → read → search` | 159 | 搜索-阅读-继续搜索 |
| 5 | `edit → read → edit` | 149 | 编辑-验证-再编辑 |
| 6 | `read → read → read` | 146 | 连续阅读（理解代码） |
| 7 | `search → search → read` | 138 | 搜索后阅读 |
| 8 | `search → read → edit` | 128 | 标准流程：搜索→读→改 |
| 9 | `read → read → edit` | 116 | 深度阅读后修改 |
| 10 | `read → edit → read` | 115 | 修改后验证 |

**成功模式特征**:
- ✅ `search → read → edit`：有序的工作流程
- ✅ `read → edit → edit`：先理解再修改
- ✅ `edit → read → edit`：修改后验证

### ❌ Top 10 失败动作序列

| 排名 | 序列 | 次数 | 模式说明 |
|------|------|------|----------|
| 1 | `search → search → search` | **14,654** | 过度搜索（迷失方向）⚠️ |
| 2 | `edit → edit → edit` | 8,458 | 盲目编辑（缺乏验证） |
| 3 | `read → read → read` | 6,604 | 重复阅读（犹豫不决） |
| 4 | `search → read → search` | 2,475 | 读后继续搜索（没找到） |
| 5 | `search → search → read` | 2,422 | 搜索很久才阅读 |
| 6 | `read → edit → read` | 1,926 | 反复验证（不确定） |
| 7 | `read → search → search` | 1,875 | 读后又搜索（混乱） |
| 8 | `read → edit → edit` | 1,866 | 与成功相同但次数少 |
| 9 | `edit → read → edit` | 1,792 | 与成功相同但次数少 |
| 10 | `navigate → navigate → navigate` | 1,775 | 在目录间徘徊 |

**失败模式特征**:
- ❌ `search → search → search`：找不到目标（14,654次！）
- ❌ `navigate → navigate → navigate`：目录结构中迷失
- ❌ `read → read → read`：犹豫不决，不敢动手

---

## 💡 关键洞察总结

### 1. 早期失败模式（73.6%）

**问题**:
- 大多数失败在前 10 步就出现
- 平均第 7 步遇到第一个错误

**建议**:
- ✅ 加强早期的问题理解
- ✅ 改进初始搜索策略
- ✅ 快速验证方向是否正确

### 2. 过度搜索问题

**问题**:
- `search → search → search` 出现 14,654 次（失败案例）
- 失败案例搜索占比 +6.34%

**建议**:
- ✅ 限制连续搜索次数
- ✅ 搜索失败后尝试其他策略
- ✅ 改进搜索关键词生成

### 3. 循环陷阱（80%）

**问题**:
- 80% 的失败案例陷入循环
- 重复相同的无效操作

**建议**:
- ✅ 检测循环模式并打破
- ✅ 记忆已尝试的操作
- ✅ 尝试不同的方法

### 4. 步骤效率差异（2倍）

**问题**:
- 失败案例平均 30.4 步
- 成功案例平均 14.6 步

**建议**:
- ✅ 提高决策效率
- ✅ 减少无效操作
- ✅ 早期发现错误方向

### 5. 编辑 vs 搜索比例

**成功特征**:
- 更多编辑 (30.4%)
- 更少搜索 (22.5%)
- 编辑/搜索比 = 1.35

**失败特征**:
- 更少编辑 (24.5%)
- 更多搜索 (28.9%)
- 编辑/搜索比 = 0.85

**建议**:
- ✅ 找到后就要敢于修改
- ✅ 不要过度搜索
- ✅ 平衡探索和执行

---

## 🎯 实用建议

### For Agent 开发者

1. **早期验证机制**
   - 前 10 步验证方向是否正确
   - 如果连续失败，重新理解问题

2. **循环检测**
   - 检测 3 次以上相同动作
   - 强制切换策略

3. **搜索限制**
   - 连续搜索不超过 5 次
   - 搜索失败后尝试其他方法

4. **动作平衡**
   - 维持编辑/搜索比 > 1.0
   - 不要过度探索

5. **测试驱动**
   - 每次修改后运行测试
   - 快速反馈循环

### For 研究人员

1. **失败原因分类**
   - 运行时错误 (32%) → 逻辑错误检测
   - 测试失败 (23%) → 不完整修复
   - 语法错误 (9%) → 代码生成质量

2. **失败阶段研究**
   - 早期失败 (74%) → 问题理解
   - 中期失败 (20%) → 执行策略
   - 后期失败 (1%) → 细节问题

3. **模式挖掘**
   - 成功序列特征学习
   - 失败序列避免

---

## 📊 数据支持

所有分析基于：
- ✅ **3,591 个真实轨迹**
- ✅ **3,249 个失败案例** (90.48%)
- ✅ **342 个成功案例** (9.52%)
- ✅ **103,705 次 AI 动作**
- ✅ **258 个不同仓库**

完整数据和代码：
- `failure_analysis_full_report.json` - 详细 JSON 报告
- `failure_analyzer.py` - 分析工具
- `swe_trajectories/` - 原始轨迹数据

---

## 🚀 下一步

1. **可视化分析**
   - 绘制失败原因饼图
   - 动作序列流程图
   - 时间序列分析

2. **深度分析**
   - 按仓库分析失败模式
   - 按模型大小对比
   - 提取错误传播路径

3. **改进建议**
   - 设计反循环机制
   - 改进早期决策
   - 优化搜索策略

4. **论文撰写**
   - 发表失败模式研究
   - 提出改进方案
   - 开源分析工具

---

**报告生成时间**: 2026-02-03
**分析师**: Claude Sonnet 4.5
**数据版本**: v1.0

需要更深入的分析吗？我可以：
1. 按仓库分析失败模式
2. 创建可视化图表
3. 提取具体的失败案例
4. 设计改进算法
