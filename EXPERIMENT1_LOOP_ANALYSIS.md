# 实验 1：循环检测与量化分析报告

## 1. 总体统计

| 指标 | 值 |
|------|-----|
| 总轨迹数 | 3591 |
| 成功 | 342 (9.5%) |
| 失败 | 3249 (90.5%) |

## 2. 循环检测结果

### 2.1 循环出现率

| 类别 | 有循环 | 无循环 | 循环率 |
|------|--------|--------|--------|
| 成功案例 | 98 | 244 | **28.7%** |
| 失败案例 | 1968 | 1281 | **60.6%** |

### 2.2 按循环类型统计

| 循环类型 | 出现次数 | 平均长度 | 平均位置 | 恢复率 |
|---------|---------|---------|---------|--------|
| 完全相同命令 | 1110 | 12.9 | 第 16.4 步 | 68.5% |
| 相同动作类型 | 3291 | 7.9 | 第 17.8 步 | 88.4% |
| 相同动作+目标 | 280 | 13.7 | 第 35.9 步 | 69.3% |

### 2.3 循环长度分布

| 循环长度 | 出现次数 | 占比 |
|---------|---------|------|
| 3 次重复 | 2317 | 49.5% |
| 4 次重复 | 822 | 17.6% |
| 5 次重复 | 344 | 7.3% |
| 6 次重复 | 227 | 4.8% |
| 7 次重复 | 112 | 2.4% |
| 8 次重复 | 100 | 2.1% |
| 9 次重复 | 59 | 1.3% |
| 10 次重复 | 32 | 0.7% |
| 11 次重复 | 36 | 0.8% |
| 12 次重复 | 22 | 0.5% |

**最长循环**: 309 次重复
**中位数**: 4 次

### 2.4 循环开始位置分析

| 阶段 | 步骤范围 | 循环数 | 占比 |
|------|---------|--------|------|
| 早期 | 0-10 步 | 2225 | 47.5% |
| 中期 | 10-30 步 | 1684 | 36.0% |
| 后期 | 30+ 步 | 772 | 16.5% |

## 3. 循环示例

### 相同动作类型循环

**hgrecco__pint-877** (❌ 失败)
- 开始于第 16 步，重复 5 次
- 模式: `['edit']`
- 示例命令: `edit 547:547`

**F5Networks__f5-icontrol-rest-python-124** (❌ 失败)
- 开始于第 3 步，重复 3 次
- 模式: `['search']`
- 示例命令: `find_file "icontrol.py"`

**netromdk__vermin-173** (❌ 失败)
- 开始于第 6 步，重复 3 次
- 模式: `['open']`
- 示例命令: `open vermin/features.py`

### 完全相同命令循环

**F5Networks__f5-icontrol-rest-python-124** (❌ 失败)
- 开始于第 15 步，重复 13 次
- 模式: `['edit 278:292']`
- 示例命令: `edit 278:292`

**netromdk__vermin-173** (❌ 失败)
- 开始于第 9 步，重复 43 次
- 模式: `['edit 8:8']`
- 示例命令: `edit 8:8`

**iterative__dvc-6933** (❌ 失败)
- 开始于第 9 步，重复 6 次
- 模式: `['edit 5:5']`
- 示例命令: `edit 5:5`

### 相同动作+目标循环

**Oefenweb__python-untraceables-5** (❌ 失败)
- 开始于第 0 步，重复 3 次
- 模式: `['search:run-sql']`
- 示例命令: `find_file "run-sql"`

**tonioo__sievelib-84** (❌ 失败)
- 开始于第 8 步，重复 4 次
- 模式: `['search:stop']`
- 示例命令: `search_file "stop" sievelib/commands.py 1`

**shaarli__python-shaarli-client-54** (❌ 失败)
- 开始于第 19 步，重复 70 次
- 模式: `['open:dummy_requests_jwt.py']`
- 示例命令: `open dummy_requests_jwt.py && edit 14:14`

## 4. 关键发现

1. **失败案例的循环率 (60.6%) 高于成功案例 (28.7%)**，差距 31.9%
2. **整体恢复率: 82.5%** - Agent 从循环中自行恢复的比例
3. **平均循环开始位置: 第 18.6 步** - 循环通常在何时开始
---

## 5. 补充分析：循环严重程度

### 5.1 严重循环 vs 轻微循环

| 循环类型 | 成功案例 | 失败案例 | 差距 |
|---------|---------|---------|------|
| 任意循环（>=3次相同动作） | 28.7% | 60.6% | 31.9% |
| **严重循环（完全相同命令>=3次）** | **6.4%** | **24.3%** | **17.9%** |

**关键发现**: 完全相同命令的重复是失败的强指标——失败案例中出现率是成功案例的 **3.8 倍**。

### 5.2 按循环数量阈值分析

| 阈值 | 成功案例 | 失败案例 | 比值 |
|------|---------|---------|------|
| >= 1 个循环 | 28.7% | 60.6% | 2.1x |
| >= 2 个循环 | 6.7% | 34.2% | 5.1x |
| >= 3 个循环 | 2.0% | 16.8% | **8.4x** |
| >= 5 个循环 | 0.3% | 4.7% | **15.7x** |

**关键发现**: 循环数量与失败高度相关。有 3 个以上循环的轨迹，失败概率是成功概率的 **8.4 倍**。

### 5.3 极端案例分析

**循环最严重的失败案例 Top 5:**

| 案例 | 循环数 | 步骤数 | 主要循环类型 |
|------|-------|-------|-------------|
| cwacek__python-jsonschema-objects-234 | 43 | 218 | action_target (42) |
| omni-us__jsonargparse-364 | 33 | 185 | action_type (33) |
| corteva__rioxarray-516 | 31 | 101 | mixed |
| inducer__pudb-260 | 26 | 233 | action_type (26) |
| sqlfluff__sqlfluff-3662 | 24 | 99 | exact_command (24) |

### 5.4 无循环的失败案例

- **数量**: 1,281 / 3,249 = **39.4%**
- **说明**: 循环不是失败的唯一原因，但是一个强指标

**结论**: 
1. 循环检测可以识别约 **60%** 的失败案例
2. **严重循环**（完全相同命令重复）是更精确的失败指标
3. 其余 40% 的失败需要其他分析方法（如任务理解错误、技术知识缺陷等）

---

## 6. 循环恢复能力分析

| 循环类型 | 恢复率 | 解释 |
|---------|--------|------|
| 完全相同命令 | 68.5% | 较难恢复 |
| 相同动作类型 | 88.4% | 容易恢复 |
| 相同动作+目标 | 69.3% | 较难恢复 |

**解读**:
- "相同动作类型"循环（如连续搜索）恢复率高，说明 agent 能切换到其他动作
- "完全相同命令"循环恢复率低，说明 agent 陷入了更深的陷阱
- 约 **31.5%** 的严重循环无法恢复，直接导致任务失败

---

**分析完成时间**: 2026-02-06
**数据来源**: 3,591 条 SWE-agent 轨迹（SWE-bench Lite）
**方法**: 自动化循环检测 + 统计分析
